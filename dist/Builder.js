import{BuilderStatements as t}from"./BuilderStatements.js";import{isFalseable as e}from"./services/FalseableService.js";import{joinOperations as s,operation as i}from"./services/OperationService.js";export class Builder{when(t,e){return t&&e(this),this}build(){let t=[],e=[];for(let s of this.getOperations())"string"==typeof s?t.push(s):(e.push(s.value),t.push(`?${e.length}`));return{query:t.join("").trimEnd(),parameters:e}}internalColumn(...t){for(let e of t)this.internalColumnAliased(e);return this}internalColumnAliased(t,s){return e(t)||this.statements.columns.push(i({type:"IDENTIFIER",identifier:t,alias:s})),this}internalTable(...t){for(let e of t)this.internalTableAliased(e);return this}internalTableAliased(t,s){return e(t)||this.statements.tables.push(i({type:"IDENTIFIER",identifier:t,alias:s})),this}internalWhere(...t){for(let s of t)e(s)||this.statements.wheres.push(s);return this}internalLimit(t,s){return this.statements.limit="number"==typeof t?{type:"STATIC",argument:t}:e(t)?void 0:t,arguments.length>=2&&this.internalOffset(s),this}internalOffset(t){return this.statements.offset="number"==typeof t?0===t?void 0:{type:"STATIC",argument:t}:e(t)?void 0:t,this}generateFromOperation(t){this.statements.tables.length>0&&t.push("FROM ",...s(this.statements.tables,", ",!1)," ")}generateSetOperation(t){this.statements.sets.length>0&&(t.push("SET "),t.push(...s(this.statements.sets,", ",!1)," "))}generateWhereOperation(t){if(this.statements.wheres.length>0){let e=i({type:"AND",expressions:this.statements.wheres,includeParens:!1});e.length>0&&t.push("WHERE ",...e," ")}}generateLimitOperation(t){void 0!==this.statements.limit&&t.push("LIMIT ",...i(this.statements.limit)," ")}generateOffsetOperation(t){void 0!==this.statements.offset&&t.push("OFFSET ",...i(this.statements.offset)," ")}constructor(){this.statements=new t}}